<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Leaflet Contour Demo</title>
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="./dist/index.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      // Access library from global namespace
      var { demTileSource, HillshadeLayer, ContourLayer, ContourLabelLayer } = mlcontour;

      // Create the map centered on Mt. Everest region
      var map = L.map("map").setView([32.05323812166998, 34.84476831161244], 11);

      // Add base tile layer
      var tileLayer = L.tileLayer("http://localhost:9000/tiles/{z}/{x}/{y}.png", {
        maxZoom: 15,
        tms: true,
      })
      tileLayer.addTo(map);
      // Create shared DEM tile source
      // var demSource = demTileSource("https://elevation-tiles-prod.s3.amazonaws.com/terrarium/{z}/{x}/{y}.png",{
      //   encoding: "terrarium",
      //   maxZoom: 13,
      //   worker: true,
      // });
      var demSource = demTileSource("http://localhost:9000/elevation/{z}/{x}/{y}",{
        encoding: "terrarium",
        maxZoom: 15,
        tms: true,
        worker: false,
      });
      // Add hillshade layer
      var hillshade = new HillshadeLayer({
        demSource: demSource,
        opacity: 0.35,
        exaggeration: 1.2,
        azimuth: 315,
        altitude: 45,
      });
      hillshade.addTo(map);

      // Add contour lines layer
      var contours = new ContourLayer({
        demSource: demSource,
        interval: 50, // 50m minor contours
        majorInterval: 250, // 250m major contours
        multiplier: 1, // meters
        minorColor: "rgba(139, 90, 43, 0.4)",
        majorColor: "rgba(139, 90, 43, 0.7)",
        minorWidth: 0.5,
        majorWidth: 1.5,
      });
      contours.addTo(map);

      // Add contour labels layer
      var labels = new ContourLabelLayer({
        demSource: demSource,
        interval: 250, // Label every 250m
        multiplier: 1,
        fontSize: 10,
        fontColor: "#4a3728",
        haloColor: "rgba(255,255,255,0.9)",
        haloWidth: 2,
        formatter: function (ele) {
          return Math.round(ele) + "m";
        },
      });
      labels.addTo(map);

      // Add layer control
      var overlays = {
        tiles: tileLayer,
        Hillshade: hillshade,
        Contours: contours,
        Labels: labels,
      };
      L.control.layers(null, overlays).addTo(map);

      console.log("Leaflet contour demo loaded");
    </script>
  </body>
</html>
